{"ast":null,"code":"import _regeneratorRuntime from\"/home/user/MyLinuxProjects/delolive/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/user/MyLinuxProjects/delolive/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{createSlice}from\"@reduxjs/toolkit\";import AuthService from\"../../services/AuthService\";import axios from\"axios\";import{API_URL}from\"../../http\";var initialState={user:{},isAuth:false,isLoading:false,isEmailSend:false,isLoadingForm:false,registrationError:'',loginError:''};export var authSlice=createSlice({name:'auth',initialState:initialState,reducers:{setAuth:function setAuth(state,action){state.isAuth=action.payload;},setUser:function setUser(state,action){state.user=action.payload;},setIsLoading:function setIsLoading(state,action){state.isLoading=action.payload;},setIsLoadingForm:function setIsLoadingForm(state,action){state.isLoadingForm=action.payload;},setIsEmailSend:function setIsEmailSend(state,action){state.isEmailSend=action.payload;},setRegistrationError:function setRegistrationError(state,action){state.registrationError=action.payload;},setLoginError:function setLoginError(state,action){state.loginError=action.payload;}}});var _authSlice$actions=authSlice.actions,setAuth=_authSlice$actions.setAuth,setUser=_authSlice$actions.setUser,setIsLoading=_authSlice$actions.setIsLoading,setIsLoadingForm=_authSlice$actions.setIsLoadingForm,setIsEmailSend=_authSlice$actions.setIsEmailSend,setRegistrationError=_authSlice$actions.setRegistrationError,setLoginError=_authSlice$actions.setLoginError;export{setAuth,setUser,setIsLoading,setIsLoadingForm,setIsEmailSend,setRegistrationError,setLoginError};export var login=function login(email,password){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(dispatch){var response,_e$response,_e$response$data,_e$response2,_e$response2$data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:dispatch(setIsLoadingForm(true));_context.prev=1;_context.next=4;return AuthService.login(email,password);case 4:response=_context.sent;console.log(response);if(response.status===200){dispatch(setLoginError(''));}localStorage.setItem(\"token\",response.data.accessToken);dispatch(setAuth(true));dispatch(setUser(response.data.user));_context.next=16;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](1);dispatch(setLoginError((_e$response=_context.t0.response)===null||_e$response===void 0?void 0:(_e$response$data=_e$response.data)===null||_e$response$data===void 0?void 0:_e$response$data.message));console.log((_e$response2=_context.t0.response)===null||_e$response2===void 0?void 0:(_e$response2$data=_e$response2.data)===null||_e$response2$data===void 0?void 0:_e$response2$data.message);case 16:_context.prev=16;dispatch(setIsLoadingForm(false));return _context.finish(16);case 19:case\"end\":return _context.stop();}},_callee,null,[[1,12,16,19]]);}));return function(_x){return _ref.apply(this,arguments);};}();};export var registration=function registration(registrationData){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(dispatch){var response,_e$response3,_e$response3$data,_e$response4,_e$response4$data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:dispatch(setIsLoadingForm(true));_context2.prev=1;_context2.next=4;return AuthService.registration(registrationData);case 4:response=_context2.sent;console.log(response);if(response.status===200){dispatch(setIsEmailSend(true));dispatch(setRegistrationError(''));}localStorage.setItem(\"token\",response.data.accessToken);dispatch(setAuth(true));dispatch(setUser(response.data.user));_context2.next=16;break;case 12:_context2.prev=12;_context2.t0=_context2[\"catch\"](1);console.log((_e$response3=_context2.t0.response)===null||_e$response3===void 0?void 0:(_e$response3$data=_e$response3.data)===null||_e$response3$data===void 0?void 0:_e$response3$data.message);dispatch(setRegistrationError((_e$response4=_context2.t0.response)===null||_e$response4===void 0?void 0:(_e$response4$data=_e$response4.data)===null||_e$response4$data===void 0?void 0:_e$response4$data.message));case 16:_context2.prev=16;dispatch(setIsLoadingForm(false));return _context2.finish(16);case 19:case\"end\":return _context2.stop();}},_callee2,null,[[1,12,16,19]]);}));return function(_x2){return _ref2.apply(this,arguments);};}();};export var logout=function logout(){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(dispatch){var response,_e$response5,_e$response5$data;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return AuthService.logout();case 3:response=_context3.sent;console.log(response);localStorage.removeItem(\"token\");dispatch(setAuth(false));dispatch(setUser({}));_context3.next=13;break;case 10:_context3.prev=10;_context3.t0=_context3[\"catch\"](0);console.log((_e$response5=_context3.t0.response)===null||_e$response5===void 0?void 0:(_e$response5$data=_e$response5.data)===null||_e$response5$data===void 0?void 0:_e$response5$data.message);case 13:case\"end\":return _context3.stop();}},_callee3,null,[[0,10]]);}));return function(_x3){return _ref3.apply(this,arguments);};}();};export var checkAuth=function checkAuth(){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(dispatch){var response,_e$response6,_e$response6$data;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:dispatch(setIsLoading(true));_context4.prev=1;_context4.next=4;return axios.get(\"\".concat(API_URL,\"/auth/refresh\"),{withCredentials:true});case 4:response=_context4.sent;console.log(response);localStorage.setItem(\"token\",response.data.accessToken);dispatch(setAuth(true));dispatch(setUser(response.data.user));_context4.next=14;break;case 11:_context4.prev=11;_context4.t0=_context4[\"catch\"](1);console.log((_e$response6=_context4.t0.response)===null||_e$response6===void 0?void 0:(_e$response6$data=_e$response6.data)===null||_e$response6$data===void 0?void 0:_e$response6$data.message);case 14:_context4.prev=14;dispatch(setIsLoading(false));return _context4.finish(14);case 17:case\"end\":return _context4.stop();}},_callee4,null,[[1,11,14,17]]);}));return function(_x4){return _ref4.apply(this,arguments);};}();};export var selectIsLoading=function selectIsLoading(state){return state.auth.isLoading;};export var selectIsLoadingForm=function selectIsLoadingForm(state){return state.auth.isLoadingForm;};export var selectIsAuth=function selectIsAuth(state){return state.auth.isAuth;};export var selectUser=function selectUser(state){return state.auth.user;};export var selectRegistrationError=function selectRegistrationError(state){return state.auth.registrationError;};export var selectLoginError=function selectLoginError(state){return state.auth.loginError;};export var selectIsEmailSend=function selectIsEmailSend(state){return state.auth.isEmailSend;};export default authSlice.reducer;","map":{"version":3,"names":["createSlice","AuthService","axios","API_URL","initialState","user","isAuth","isLoading","isEmailSend","isLoadingForm","registrationError","loginError","authSlice","name","reducers","setAuth","state","action","payload","setUser","setIsLoading","setIsLoadingForm","setIsEmailSend","setRegistrationError","setLoginError","actions","login","email","password","dispatch","response","console","log","status","localStorage","setItem","data","accessToken","message","registration","registrationData","logout","removeItem","checkAuth","get","withCredentials","selectIsLoading","auth","selectIsLoadingForm","selectIsAuth","selectUser","selectRegistrationError","selectLoginError","selectIsEmailSend","reducer"],"sources":["/home/user/MyLinuxProjects/delolive/frontend/src/components/globalSlices/authSlice.ts"],"sourcesContent":["import { PayloadAction, createSlice } from \"@reduxjs/toolkit\";\nimport IAuth from \"../../types/interfaces/IAuth\";\nimport { IUser } from \"../../types/interfaces/IUser\";\nimport AuthService from \"../../services/AuthService\";\nimport userModel from \"../../types/UserModel\";\nimport { AuthResponse } from \"../../types/interfaces/AuthResponse\";\nimport axios from \"axios\";\nimport { API_URL } from \"../../http\";\n\nconst initialState: IAuth = {\n    user: {} as IUser,\n    isAuth: false,\n    isLoading: false,\n    isEmailSend: false,\n    isLoadingForm: false,\n    registrationError: '',\n    loginError: ''\n};\n\nexport const authSlice = createSlice({\n    name: 'auth',\n    initialState,\n    reducers: {\n        setAuth(state, action: PayloadAction<boolean>) {\n            state.isAuth = action.payload\n        },\n        setUser(state, action: PayloadAction<IUser>) {\n            state.user = action.payload\n        },\n        setIsLoading(state, action: PayloadAction<boolean>) {\n            state.isLoading = action.payload\n        },\n        setIsLoadingForm(state, action: PayloadAction<boolean>) {\n            state.isLoadingForm = action.payload\n        },\n        setIsEmailSend(state, action: PayloadAction<boolean>) {\n            state.isEmailSend = action.payload\n        },\n        setRegistrationError(state, action: PayloadAction<string>) {\n            state.registrationError = action.payload\n        },\n        setLoginError(state, action: PayloadAction<string>) {\n            state.loginError = action.payload\n        }\n     }\n})\n\nexport const { setAuth, setUser, setIsLoading, setIsLoadingForm, setIsEmailSend, setRegistrationError, setLoginError } = authSlice.actions;\n\nexport const login = (email: string, password: string) => async (dispatch: any) => {\n    dispatch(setIsLoadingForm(true))\n    try {\n        const response = await AuthService.login(email, password);\n        console.log(response);\n        if(response.status === 200) {\n            dispatch(setLoginError(''))\n        }\n        localStorage.setItem(\"token\", response.data.accessToken);\n\n        dispatch(setAuth(true));\n        dispatch(setUser(response.data.user));\n    } catch (e: any) {\n        dispatch(setLoginError(e.response?.data?.message))\n        console.log(e.response?.data?.message);\n    } finally {\n        dispatch(setIsLoadingForm(false))\n    }\n\n}\n\nexport const registration = (registrationData: userModel) => async (dispatch: any) => {\n    dispatch(setIsLoadingForm(true))\n    try {\n        const response = await AuthService.registration(registrationData);\n        console.log(response);\n        if(response.status === 200) {\n            dispatch(setIsEmailSend(true))\n            dispatch(setRegistrationError(''))\n        }\n        localStorage.setItem(\"token\", response.data.accessToken);\n\n        dispatch(setAuth(true));\n        dispatch(setUser(response.data.user));\n    } catch (e: any) {\n        console.log(e.response?.data?.message);\n        dispatch(setRegistrationError(e.response?.data?.message))\n    } finally {\n        dispatch(setIsLoadingForm(false))\n    }\n    \n}\n\nexport const logout = () => async (dispatch: any) => {\n\n    try {\n        const response = await AuthService.logout();\n        console.log(response);\n        localStorage.removeItem(\"token\");\n\n        dispatch(setAuth(false));\n        dispatch(setUser({} as IUser));\n    } catch (e: any) {\n        console.log(e.response?.data?.message);\n    }\n    \n}\n\nexport const checkAuth = () => async (dispatch: any) => {\n    dispatch(setIsLoading(true));\n    try {\n        const response = await axios.get<AuthResponse>(`${API_URL}/auth/refresh`, {\n            withCredentials: true,\n        });\n        console.log(response);\n        localStorage.setItem(\"token\", response.data.accessToken);\n\n        dispatch(setAuth(true));\n        dispatch(setUser(response.data.user));\n    } catch (e: any) {\n        console.log(e.response?.data?.message)\n    } finally {\n        dispatch(setIsLoading(false))\n    }\n}\n\nexport const selectIsLoading = (state: any) => state.auth.isLoading;\nexport const selectIsLoadingForm = (state: any) => state.auth.isLoadingForm;\nexport const selectIsAuth = (state: any) => state.auth.isAuth;\nexport const selectUser = (state: any) => state.auth.user;\nexport const selectRegistrationError = (state: any) => state.auth.registrationError;\nexport const selectLoginError = (state: any) => state.auth.loginError;\nexport const selectIsEmailSend = (state: any) => state.auth.isEmailSend;\n\nexport default authSlice.reducer;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}